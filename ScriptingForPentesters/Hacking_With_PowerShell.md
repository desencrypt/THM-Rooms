# __Basic Powershell Commands__

## __Using Get-Help__

```powershell
Get-Help Command-Name # get help for a PowerShell cmdlet 
# You can also understand how exactly to use the command by passing in the -examples flag.
```

## __Using Get-Command__

```powershell
Get-Command New-* # view all the cmdlets for the verb new
Get-Command Verb-*
Get-Command *-Noun
```

## __Object Manipulation__

```powershell
# The Pipeline(|) is used to pass output from one cmdlet to another.
# Verb-Noun | Get-Member
Get-Command | Get-Member -MemberType Method # view the members for Get-Command
```

## __Creating Objects From Previous cmdlets__

One way of manipulating objects is pulling out the properties from the output of a cmdlet and creating a new object. This is done using the `Select-Object` cmdlet. 

```powershell
Get-ChildItem | Select-Object -Property Mode, Name # listing the directories selecting the mode and the name
```

## __Filtering Objects__

When retrieving output objects, you may want to select objects that match a very specific value. You can do this using the `Where-Object` to filter based on the value of properties. 

```powershell
Verb-Noun | Where-Object -Property PropertyName -operator Value # general format
Verb-Noun | Where-Object {$_.PropertyName -operator Value} # general format v2
Get-Service | Where-Object -Property Status -eq Stopped # checking the stopped processes
```

## __Sort Object__

When a cmdlet outputs a lot of information, you may need to sort it to extract the information more efficiently. You do this by pipe lining the output of a cmdlet to the `Sort-Object` cmdlet.

```powershell
Verb-Noun | Sort-Object # general format
Get-ChildItem | Sort-Object
```

# __Files__

## __Search__

```powershell
Get-ChildItem -Path "C:\" -Include *.txt -recurse -File
Get-ChildItem -Path C:\ -Include *interesting-file.txt* -File -Recurse -ErrorAction SilentlyContinue # one in particular
```

## __Content__

```powershell
Get-Content "C:\...\file.txt"
```

## __Cmdlets installed__

```powershell
Get-Command | Where-Object -Property CommandType -eq Cmdlet | measure
```

## __Current directory__

```powershell
Get-Location
Get-Location -Path "C:\Users\Administrator\Documents\Passwords" # check that a location exists
```

## __Hash__

```powershell
Get-FileHash -Algorithm MD5 file
```

## __Decode__

```powershell
certutil -decode "C:\Users\Administrator\Desktop\b64.txt" out.txt
Get-Content out.txt
```

# __Enumeration__

## __Users__

```powershell
net user
```

### __SID__

```powershell
Get-LocalUser -SID "S-1-5-21-1394777289-3961777894-1791813945-501" # one in particular
gwmi win32_UserAccount | Select Name, FullName, Caption, Domain, SID | ft -AutoSize
```

### __Password value set to False__

```powershell
Get-LocalUser | Where-Object -Property PasswordRequired -Match false
```

## __Groups__

```powershell
Get-LocalGroup | measure
```

## __IP address info__

```powershell
Get-NetIPAddress
```

## __Ports__

```powershell
Get-NetTCPConnection
```

### __Listening__

```powershell
GEt-NetTCPConnection | Where-Object -Property State -Match Listen # view the ports
GEt-NetTCPConnection | Where-Object -Property State -Match Listen | measure # view the number of ports
```

## __Patches__

```powershell
Get-Hotfix
Get-Hotfix | measure
Get-Hotfix -Id <id>
```

## __Backups__

```powershell
Get-ChildItem -Path C:\ -Include *.bak* -recurse -Files -ErrorAction SilentlyContinue
```

## __All files containing API_KEY__

```powershell
Get-ChildItem C:\* -Recurse | Select-String -pattern API_KEY
```

## __Running processes__

```powershell
Get-Process
```

## __Scheduled tasks__

```powershell
Get-ScheduleTask
Get-ScheduleTask -TaskName <taskname>
```

## __Owner of the C:\ directory__

```powershell
Get-Acl c:/
```

# __Basic Scripting Challenge__

## __Variables__

```powershell
$variable_name = value
```

## __Loops__

```powershell
foreach($new_var in $existing_var){}
```

## __Listening ports__

```powershell
$system_ports = Get-NetTCPConnection -State Listen

$text_port = Get-Content -Path C:\Users\Administrator\Desktop\ports.txt

foreach($port in $text_port){

    if($port -in $system_ports.LocalPort){
        echo $port
     }
}
```

## __What file contains the password?__

```powershell
Get-ChildItem -Path "C:\Users\Administrator\Desktop\emails\*" -Recurse | Select-String -Pattern password
```

```powershell
$path = "C:\Users\Administrator\Desktop\emails\*"
$string_pattern = "password"
$command = Get-ChildItem -Path $path -Recurse | Select-String -Pattern $String_pattern
echo $command
```

## __What file contains an HTTPS link?__

```powershell
$path = "C:\Users\Administrator\Desktop\emails\*"
$string_pattern = "https://"
$command = Get-ChildItem -Path $path -Recurse | Select-String -Pattern $String_pattern
echo $command
```

# __Intermediate scripting__

## __How many open ports did you find between 130 and 140(inclusive of those two)?__

```powershell
for ($i = 130; $i -le 140; $i++) {
    Test-NetConnection localhost -Port $i
}
```

